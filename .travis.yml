language: php
php:
  - 7.0
  - 7.1
  - 7.2
  - 7.3
  - 7.4
  - 8.0

sudo: false

cache:
  directories:
    - $HOME/.composer/cache

matrix:
  fast_finish: true
  allow_failures:
    - php: 8.0
  include:
    - php: 5.6
      dist: trusty

before_script:
  - if [ "$TRAVIS_PHP_VERSION" = "8.0" ]; then
      composer install --no-interaction --ignore-platform-reqs;
    else
      composer install --no-interaction;
    fi
  - if [ "$TRAVIS_PHP_VERSION" = "7.1" ]; then
      curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter;
      chmod +x ./cc-test-reporter;
      ./cc-test-reporter before-build;
    fi

script:
  - composer code-style
  - if [ "$TRAVIS_PHP_VERSION" = "7.1" ]; then
      vendor/bin/phpunit -c phpunit.xml --coverage-clover=clover.xml --coverage-text --color=always;
    elif [ "$TRAVIS_PHP_VERSION" = "5.6" ] || [ "$TRAVIS_PHP_VERSION" = "7.0" ]; then
      vendor/bin/phpunit -c phpunit.xml --color=always --printer=PHPUnit_TextUI_ResultPrinter;
    else
      vendor/bin/phpunit -c phpunit.xml --color=always;
    fi

after_script:
  - if [ "$TRAVIS_PHP_VERSION" = "7.1" ]; then
      ./cc-test-reporter after-build --coverage-input-type clover --exit-code $TRAVIS_TEST_RESULT;
    fi
